<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Posts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/postCss.css">
</head>
<body>
<div class="container">

    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-users"></i>
                <span>WorkHub</span>
            </div>
        </div>
    </header>

    <div class="preview-container" id="previewContainer"></div>


</div>

<script>
    let jobs = [];
    document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token")
        fetch("http://localhost:8080/company/getCompanyPost", {
            method: 'Get',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            }

        }).then(res => res.json())
            .then(response => {
                jobs = response.data; // data object එක

                jobs.forEach(job => {
                    getProfile(job.username, job)

                });


                // console.log(jobs);    // Software Development
            });
    });



    function getProfile(userID, job) {
        const token = localStorage.getItem("token")
        fetch("http://localhost:8080/company/profile?userID="+userID, {
            method: 'Get',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            }

        }).then(res => res.json())
            .then(response => {
                const profile =  response.data; // data object එක
                // setData(jobs);
                console.log(profile.companyName)
                console.log(profile.profileImage)
                console.log("3")

                setData(job, profile.companyName, profile.profileImage)

                // console.log(jobs);    // Software Development
            });

    }


    function setData(job, profileName, profileImage) {



        const container = document.getElementById("previewContainer");

        // jobs.forEach(job => {
            console.log("1")
            console.log("2")
            // let name = profile.companyName

            console.log(job);
            const card = document.createElement("div");
            card.classList.add("post-card");

            card.innerHTML = `
            <div class="post-header">
                    <img class="company-logo" src=${profileImage || "/default-logo.png"} alt="Company Logo"/>
                <div class="post-meta">
                    <h3>${profileName}</h3>
                    <div class="post-date">
                        <i class="far fa-clock"></i> <span>${formatDateTime(job.createdAt)}</span>
                    </div>
                </div>
                <div class="post-menu">
                    <i class="fas fa-ellipsis-h"></i>
                </div>
            </div>

            <div class="post-content">
                <div class="job-caption">
                    <span class="caption-item"><i class="fas fa-map-marker-alt"></i> ${job.address}</span>
                    <span class="caption-item"><i class="fas fa-briefcase"></i> ${job.experienceRequired}</span>
                    <span class="caption-item"><i class="fas fa-dollar-sign"></i> ${job.salaryRange}</span>
                    <span class="caption-item"><i class="fas fa-tools"></i> ${job.skills}</span>
                    <span class="caption-item"><i class="fas fa-clock"></i> ${job.jobType}</span>
                </div>

                <p class="post-text">${job.jobDescription}</p>

                <img src="${job.jobImagePath}" alt="Job Image" class="post-image">
            </div>

            <div class="post-actions">
                <div class="post-action">
                    <i class="far fa-comments"></i> Chat
                </div>
                <div class="post-action">
                    <i class="fas fa-map-marker-alt"></i> ${job.workMode}
                </div>
            </div>
        `;

            container.appendChild(card);

        // });

    }
    function formatDateTime(timestamp) {
        const date = new Date(timestamp);
        return date.toLocaleString("en-US", {
            year: "numeric",
            month: "short",
            day: "2-digit",
            hour: "2-digit",
            minute: "2-digit"
        });
    }

    console.log(formatDateTime("2025-09-14T08:56:33.942"));


</script>


</body>
</html>